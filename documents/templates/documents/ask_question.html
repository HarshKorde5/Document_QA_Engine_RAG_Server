{% extends 'base.html' %}

{% block content %}
  <div class="row justify-content-center mt-5 mb-5">
    <div class="col-lg-9 col-xl-8">
      <h1 class="display-6 fw-bold text-center mb-4 text-dark">
        <i class="bi bi-chat-dots-fill text-primary me-2"></i> Ask AI about:
        <span class="text-success">{{ document.title }}</span>
      </h1>
      <p class="lead text-center text-muted mb-5">Query your uploaded documents using natural language. The AI will retrieve the most relevant information to provide an accurate answer.</p>

      <div class="card shadow-lg border-0 rounded-4 mb-5">
        <div class="card-body p-4 p-md-5">
          <form method="post">
            {% csrf_token %}
            <div class="mb-4">
              <label for="questionInput" class="form-label h5 fw-bold text-primary">What is your question?</label>
              <input type="text" class="form-control form-control-lg border-2" id="questionInput" name="question" placeholder="e.g., Summarize the key findings from the annual report." value="{{ question|default:'' }}" required />
            </div>
            <div class="text-center">
              <button type="submit" class="btn btn-primary btn-lg w-75 shadow-lg"><i class="bi bi-robot me-2"></i> Generate Answer</button>
            </div>
          </form>
        </div>
      </div>

      {% if answer %}
        <hr class="my-5" />

        <div class="card border-success shadow-lg rounded-4 mb-4">
          <div class="card-header bg-success text-white d-flex align-items-center py-3">
            <i class="bi bi-stars h4 mb-0 me-2"></i>
            <h4 class="mb-0 fw-bold">AI Answer</h4>
          </div>
          <div class="card-body p-4 p-md-5">
            <p class="card-text lead text-dark">{{ answer }}</p>
          </div>
        </div>

        <div class="mt-4 border-start border-3 border-info ps-3">
          <h6 class="fw-bold text-info mb-3"><i class="bi bi-journal-text me-1"></i> Retrieval Source</h6>
          <div class="bg-light p-4 border rounded small text-monospace">
            <p class="text-muted mb-0">The following excerpt was used by the AI to formulate the response:</p>
            <pre class="mb-0 text-break text-wrap border-top pt-2 mt-2">{{ source_snippet }}</pre>
          </div>
        </div>
      {% endif %}
    </div>
  </div>
{% endblock %}
